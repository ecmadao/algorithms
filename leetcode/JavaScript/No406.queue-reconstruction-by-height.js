/**
 * Difficulty:
 * Medium
 *
 * Desc:
 * Suppose you have a random list of people standing in a queue.
 * Each person is described by a pair of integers (h, k), where h is the height of the person and k is the number of people in front of this person who have a height greater than or equal to h.
 * Write an algorithm to reconstruct the queue.
 *
 * Example
 * Input:
 * [[7,0], [4,4], [7,1], [5,0], [6,1], [5,2]]
 * Output:
 * [[5,0], [7,0], [5,2], [6,1], [4,4], [7,1]]
 *
 * Note:
 * The number of people is less than 1,100.
 */


var searchInsert = function(nums, target) {
  var left = 0;
  var right = nums.length - 1;
  var index = null;

  while (left <= right) {
    var midIndex = Math.floor((left + right) / 2);
    var mid = nums[midIndex];
    if (mid === target) {
      index = midIndex;
      break;
    } else if (mid > target) {
      right = midIndex - 1;
    } else {
      left = midIndex + 1;
    }
  }

  if (index === null) {
    left -= 1;
    var num = nums[left];
    if (num > target) {
      if (left - 1 < 0 || nums[left - 1] < target) {
        index = left;
      }
    } else {
      if (left + 1 > nums.length -1 || nums[left + 1] > target) {
        index = left + 1;
      }
    }
  }

  return index;
};

/**
 * @param {number[][]} people
 * @return {number[][]}
 */
var reconstructQueue = function(people) {
  const tmp = [];

  const insert = (arr, val) => {
    const index = searchInsert(arr, val);
    arr.splice(index, 0, val);
  };

  for (const list of people) {
    const [height, count] = list;
    if (!tmp[count]) tmp[count] = [];
    insert(tmp[count], height);
  }

  const getNotLessThan = (queue, num) => {
    let count = 0;
    const remains = [];

    for (const list of queue) {
      if (list[0] >= num) {
        count += 1;
      } else {
        remains.push(list);
      }
    }
    return {
      count,
      remains
    };
  };

  const requeue = (queue) => {
    const max = queue.length;
    if (max === people.length) return true;

    for (let i = max; i >= 0; i -= 1) {
      const heights = tmp[i];
      if (!heights || heights.length === 0) continue;

      let curCount = 0;
      let queueTmp = queue;
      for (let j = 0; j < heights.length; j += 1) {
        const height = heights[j];
        const notLessThanTmp = getNotLessThan(queueTmp, height);
        curCount += notLessThanTmp.count;
        queueTmp = notLessThanTmp.remains;

        if (curCount !== i) {
          if (curCount < i) break;
          continue;
        }

        tmp[i].splice(j, 1);
        queue.push([height, i]);
        const result = requeue(queue);
        if (result) return true;
        queue.pop();
        tmp[i].splice(j, 0, height);
      }
    }

    return false;
  }

  const result = [];
  requeue(result);
  return result;
};

/* =============== a faster solution =============== */
const reconstructQueue2 = (people) => {
  people.sort((a, b) => a[0] !== b[0] ? b[0] - a[0] : a[1] - b[1]);

  const queue = [];
  for (const person of people) {
    queue.splice(person[1], 0, person);
  }
  return queue;
};

console.log(reconstructQueue([[7,0], [4,4], [7,1], [5,0], [6,1], [5,2]]));
console.log(reconstructQueue(
  [[40,11],[81,12],[32,60],[36,39],[76,19],[11,37],[67,13],[45,39],[99,0],[35,20],[15,3],[62,13],[90,2],[86,0],[26,13],[68,32],[91,4],[23,24],[73,14],[86,13],[62,6],[36,13],[67,9],[39,57],[15,45],[37,26],[12,88],[30,18],[39,60],[77,2],[24,38],[72,7],[96,1],[29,47],[92,1],[67,28],[54,44],[46,35],[3,85],[27,9],[82,14],[29,17],[80,11],[84,10],[5,59],[82,6],[62,25],[64,29],[88,8],[11,20],[83,0],[94,4],[43,42],[73,9],[57,32],[76,24],[14,67],[86,2],[13,47],[93,1],[95,2],[87,8],[8,78],[58,16],[26,75],[26,15],[24,56],[69,9],[42,22],[70,17],[34,48],[26,39],[22,28],[21,8],[51,44],[35,4],[25,48],[78,18],[29,30],[13,63],[68,8],[21,38],[56,20],[84,14],[56,27],[60,40],[98,0],[63,7],[27,46],[70,13],[29,23],[49,6],[5,64],[67,11],[2,31],[59,8],[93,0],[50,39],[84,6],[19,39]]
));

console.log(reconstructQueue(
  [[728496,52],[148863,565],[850202,24],[854447,98],[523539,372],[707601,238],[769743,101],[945942,9],[212892,599],[779386,36],[638765,36],[324344,463],[834907,110],[973107,23],[399261,67],[167996,331],[355952,8],[560961,167],[211289,592],[951713,34],[537474,457],[513885,113],[688094,56],[760705,210],[602577,357],[160755,716],[423336,110],[655144,255],[43872,748],[698888,29],[90555,655],[773873,28],[704851,15],[774827,178],[853921,128],[186760,770],[310631,47],[780500,180],[594307,115],[492968,70],[529371,68],[47085,811],[134716,285],[441295,563],[763603,187],[717699,78],[97967,564],[475051,40],[805603,104],[308246,117],[133600,421],[366506,248],[465660,242],[660427,266],[511384,395],[313498,602],[628965,79],[953927,4],[351039,629],[185898,504],[59054,374],[126768,741],[846813,93],[795869,56],[812584,72],[580169,162],[427366,196],[117541,365],[261991,695],[599982,246],[814746,83],[240128,306],[314238,519],[347435,196],[435479,493],[314683,229],[814809,56],[659620,315],[191228,656],[713210,192],[282987,259],[416753,327],[462078,290],[528474,183],[993781,5],[406711,326],[348729,632],[645762,153],[649752,230],[539240,48],[8328,366],[743458,23],[441642,290],[795472,110],[661748,104],[728584,151],[246210,267],[158893,484],[321088,74],[752912,45],[507882,112],[868541,46],[22578,288],[468989,255],[123913,186],[387899,321],[252146,379],[578030,41],[577994,358],[200108,656],[580085,379],[536646,194],[787842,95],[239517,692],[895705,26],[282077,473],[59904,808],[825790,32],[743349,241],[518054,142],[748904,128],[515837,62],[871023,24],[548881,298],[8568,302],[793927,12],[595984,321],[851666,70],[915613,54],[137101,736],[554980,331],[515175,15],[949151,15],[586264,168],[744636,218],[184210,357],[798941,147],[86512,219],[307327,499],[343095,289],[890802,73],[897293,57],[173702,243],[561360,176],[21557,485],[652977,8],[846659,137],[63497,541],[9038,885],[993461,8],[716390,37],[144163,750],[662454,61],[810318,129],[904603,39],[622409,70],[968698,27],[567796,115],[371421,210],[646919,258],[889788,65],[993518,0],[847382,62],[63062,338],[136024,337],[494747,488],[31711,420],[436217,463],[708074,90],[557073,282],[188113,455],[988100,15],[279950,76],[81041,432],[741015,64],[794716,82],[504178,421],[576879,258],[652991,307],[87033,133],[671528,44],[660787,146],[3658,219],[334712,574],[432610,359],[413481,124],[761793,75],[629666,334],[565382,52],[126267,858],[769585,157],[77941,911],[100422,685],[580777,210],[733495,163],[500799,385],[111769,235],[745989,20],[319229,366],[520182,64],[237224,749],[520602,282],[549957,20],[678103,108],[194688,390],[532840,9],[730360,146],[332231,538],[857196,77],[418009,529],[361063,394],[389225,141],[736077,121],[630780,243],[480086,161],[55332,198],[8900,654],[284259,2],[680495,35],[906096,58],[784925,131],[873009,20],[472696,51],[755098,40],[824763,92],[609302,186],[600359,19],[211859,399],[256629,248],[153050,120],[620605,259],[906660,14],[109935,243],[83088,465],[592596,34],[188387,639],[426866,249],[420995,312],[359223,525],[900492,85],[874975,53],[222190,375],[615502,31],[395013,320],[848099,23],[803513,39],[604677,335],[977447,7],[734505,160],[688883,0],[495988,425],[407502,332],[958781,38],[943022,60],[452351,417],[497935,489],[390221,99],[547937,196],[47436,670],[720771,151],[53655,661],[942034,48],[569908,297],[444767,494],[21116,450],[196007,739],[30696,949],[976659,0],[737802,151],[872484,93],[574585,9],[959080,1],[399722,441],[923254,56],[624854,50],[863766,3],[829557,47],[924874,54],[841954,93],[480835,215],[102966,389],[151507,553],[170429,463],[245555,393],[826220,81],[723147,224],[971048,3],[684635,150],[177449,783],[88276,561],[846162,52],[149281,605],[475114,169],[83200,509],[495776,101],[665487,127],[269614,697],[263589,117],[693634,64],[978004,12],[640750,65],[505863,376],[120366,145],[166069,51],[757415,139],[314704,66],[206560,269],[545526,449],[811733,100],[584485,220],[387948,278],[999096,0],[469756,163],[627551,81],[957797,43],[700962,16],[209358,127],[455507,233],[504449,464],[210423,640],[983807,6],[892722,35],[518141,423],[591537,262],[607741,56],[772309,40],[320970,471],[502386,26],[285167,629],[15271,411],[784061,31],[119446,292],[489669,111],[703148,131],[931519,49],[130583,287],[403805,401],[170461,715],[855488,122],[768890,116],[532090,122],[270019,42],[896050,4],[24801,272],[983739,12],[519554,62],[556243,111],[484142,35],[37339,605],[726734,160],[97512,674],[232027,277],[130539,576],[545848,252],[9545,149],[127295,132],[92647,857],[484047,216],[227448,271],[364602,570],[285430,522],[705134,50],[2429,365],[678852,3],[820174,42],[636999,226],[189902,76],[622285,307],[30291,612],[371000,114],[441153,422],[107776,504],[387662,80],[251408,117],[592972,319],[115944,534],[659432,286],[658196,79],[230692,175],[847582,68],[350771,296],[467688,246],[466328,200],[874427,47],[667748,98],[33398,503],[230949,670],[382040,269],[382650,142],[46758,288],[398544,244],[49088,547],[679954,82],[547410,85],[717932,150],[43118,925],[602871,58],[589375,338],[988342,14],[455190,51],[171280,762],[377985,494],[28296,280],[598869,138],[194568,568],[652516,12],[132824,488],[669635,196],[93409,863],[704242,14],[301398,183],[521365,71],[189396,80],[147442,825],[70158,711],[712142,19],[455021,163],[870590,39],[20955,430],[296028,225],[242700,387],[358340,42],[285732,552],[979059,22],[524786,40],[399478,76],[992848,11],[957324,21],[687217,243],[863084,10],[283209,218],[181978,777],[554236,164],[680691,21],[225144,175],[146222,43],[851507,40],[258062,168],[35466,524],[527544,363],[429385,253],[392877,131],[960462,12],[800446,66],[573633,80],[744276,202],[226116,120],[451370,461],[131575,321],[830682,74],[909283,7],[24120,193],[157518,476],[649731,284],[826427,69],[768832,3],[766761,35],[247299,253],[437769,564],[988534,1],[864827,69],[171236,647],[266805,366],[672475,65],[633811,6],[378989,341],[491591,196],[794798,95],[744814,191],[661455,295],[115096,189],[269905,338],[895836,89],[7261,68],[616957,116],[779578,10],[174174,290],[809910,13],[952559,29],[908147,74],[691605,276],[305921,118],[382209,153],[593453,208],[419044,186],[406858,512],[713221,209],[99142,871],[848525,25],[649024,260],[134850,787],[519532,404],[361135,400],[154520,462],[22049,604],[881789,62],[518912,347],[280134,585],[143152,756],[628848,323],[263012,93],[591351,142],[559764,169],[825651,1],[848875,34],[78591,353],[108484,102],[446444,38],[510225,114],[592201,155],[457637,117],[585303,167],[245486,299],[398970,91],[574839,388],[539718,131],[555027,336],[243653,701],[903959,33],[164020,441],[262198,630],[219014,458],[813252,132],[213813,677],[840964,108],[780031,104],[254715,236],[938779,2],[274058,712],[991927,4],[870036,54],[447764,280],[796790,66],[714786,62],[152916,572],[847495,50],[711646,182],[262674,162],[742111,189],[209420,160],[317769,446],[669942,122],[451109,445],[891902,61],[655913,30],[456434,60],[211969,707],[510393,364],[549551,405],[855628,120],[320959,620],[799694,53],[262099,51],[601855,335],[966854,17],[347909,38],[960645,34],[148895,289],[298947,608],[748132,134],[429801,165],[232243,745],[735125,38],[466348,79],[348740,640],[43227,235],[533450,247],[286317,401],[385313,205],[451542,246],[23244,19],[461969,512],[532009,115],[63049,883],[385717,285],[890976,75],[410584,126],[617845,175],[778596,99],[689980,108],[745659,136],[623936,89],[944148,20],[279216,9],[570024,56],[625606,223],[246419,409],[451739,158],[475596,503],[9324,787],[967862,9],[133653,735],[130398,417],[215406,395],[151446,665],[143041,226],[973713,21],[347940,325],[2429,342],[188233,228],[213736,330],[857018,73],[938512,60],[264201,180],[727883,198],[60939,479],[388258,608],[515583,161],[654214,195],[432989,312],[319451,62],[489547,190],[421476,467],[252191,388],[153958,108],[658716,326],[250269,408],[430804,204],[234944,217],[852718,130],[430026,466],[156839,614],[603177,239],[840352,11],[169466,43],[304773,179],[558571,365],[183971,738],[980204,22],[519354,111],[670778,79],[206456,6],[543997,145],[843424,68],[997102,0],[845040,61],[715685,187],[357987,194],[991121,9],[583429,51],[274436,221],[667319,152],[96829,0],[487325,227],[98366,111],[392574,228],[355975,518],[850805,122],[715932,211],[604521,159],[981369,19],[640967,179],[200638,707],[977268,1],[144572,630],[739204,214],[573266,27],[6157,854],[435492,193],[5634,79],[337121,578],[46711,236],[518589,318],[510974,160],[423562,469],[537395,385],[58703,426],[774866,194],[381380,540],[617807,291],[383176,49],[493978,142],[598256,324],[602476,191],[709635,234],[428255,133],[56987,163],[307067,556],[216098,559],[961810,12],[996626,1],[947243,54],[185480,445],[451002,272],[948402,43],[198575,9],[569343,188],[309145,168],[569780,110],[359979,105],[751470,146],[203277,151],[855525,56],[259471,697],[49339,297],[914301,67],[80026,108],[858471,75],[616080,191],[214945,229],[895322,39],[136554,361],[164104,108],[18461,283],[204601,663],[786360,81],[223735,764],[106106,44],[783051,176],[359881,328],[774889,160],[598907,153],[272062,494],[801058,157],[577823,333],[569690,255],[993487,4],[711504,20],[313462,496],[538432,102],[673937,157],[275405,448],[714601,223],[414408,421],[572366,184],[828552,20],[416479,500],[305052,260],[452375,133],[468881,264],[130564,221],[349899,336],[751783,37],[797622,53],[125872,348],[552268,181],[142024,453],[475641,64],[101444,325],[473649,236],[53539,616],[638889,92],[612208,159],[107757,134],[5632,368],[470686,366],[253187,650],[993126,7],[464950,452],[263243,133],[338796,38],[185764,408],[317585,625],[167237,802],[891645,12],[257971,354],[611011,291],[903901,36],[176316,712],[514488,231],[622482,363],[680328,258],[218572,580],[826265,92],[813581,141],[681237,163],[501905,261],[233664,410],[431366,378],[472891,219],[751950,4],[902204,60],[148066,751],[829296,30],[994413,4],[728386,168],[325783,233],[887326,74],[458356,72],[68158,122],[878940,65],[5952,915],[142742,614],[691092,179],[433178,53],[798782,11],[791173,22],[520277,333],[438616,421],[403375,538],[192426,16],[679855,48],[244070,652],[995261,3],[379885,562],[388440,440],[477592,225],[86290,372],[668248,302],[198234,278],[930114,49],[969266,5],[222210,327],[239428,174],[575063,147],[143651,107],[987322,18],[541206,389],[876831,22],[749346,11],[719909,212],[460459,326],[328566,432],[849872,14],[839767,58],[247220,418],[479515,165],[90210,64],[125094,417],[933922,47],[131143,709],[869366,65],[779368,133],[683366,197],[732118,127],[313160,82],[105821,557],[977990,14],[458320,212],[472543,351],[640526,138],[478912,306],[156109,688],[795718,124],[8624,492],[687757,33],[753675,117],[664447,37],[793100,103],[793803,124],[783593,126],[738985,173],[144020,151],[624808,288],[390406,394],[540384,312],[274890,491],[935702,29],[436756,374],[420178,356],[656473,237],[51376,183],[644449,88],[21784,312],[381474,483],[583178,78],[641889,271],[72976,21],[380608,213],[733648,234],[663264,203],[959006,13],[200982,636],[653313,302],[783991,184],[965170,4],[665273,120],[875926,19],[794556,90],[238199,527],[56565,581],[42974,295],[15452,297],[290486,102],[381735,625],[69470,432],[23528,800],[128545,720],[733727,80],[865524,52],[3117,570],[679396,125],[51334,200],[892212,9],[654805,131],[490223,103],[388393,518],[59940,411],[228810,29],[199837,631],[202677,66],[268318,576],[9183,311],[351644,111],[397991,238],[517268,471],[396126,211],[637282,112],[461296,94],[208842,270],[450376,201],[23740,7],[693564,180],[873705,59],[637777,291],[682184,225],[952087,28],[803123,45],[431362,434],[394827,95],[868190,64],[640292,191],[865002,24],[534373,179],[614270,180],[839559,98],[740902,209],[606356,25],[459787,456],[905597,39],[72444,740],[414910,374],[925019,2],[574703,58],[128771,417],[792081,119],[161669,385],[677093,239],[475794,305],[133447,516],[868731,90],[186634,236],[954715,21],[308144,272],[956508,40],[952286,21],[401606,2],[761527,81],[609941,254],[655485,181],[811505,101],[103994,296],[287895,386],[624099,20],[290176,327],[159587,54],[990669,5],[967659,35],[97364,620],[457515,402],[338053,32],[371206,253],[736584,238],[62223,638],[169008,18],[667105,58],[671026,81],[465195,301],[61190,547],[519614,463],[49557,71],[178431,732],[823138,58],[624706,197],[18142,434],[860798,56],[150484,678],[5548,194],[566963,363],[88474,523],[113573,759],[149638,832],[933772,39],[295983,682],[940123,26],[187931,772],[76204,470],[902044,9],[996340,1],[5272,450],[943976,54],[661806,252],[233429,592],[427354,467],[682401,13],[343174,309],[559901,112],[272267,98],[137436,99],[397112,529],[995349,0],[280317,640],[210974,335],[832583,117],[211697,282],[928187,37],[784242,50],[13821,890],[888562,68],[509689,308]]
));
